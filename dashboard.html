<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #7b4ae2, #b26dfc);
        min-height: 100vh;
        color: white;
        display: flex;
        flex-direction: column;
        transition: all 0.3s ease;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 60px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
      }

      .logo {
        font-size: 24px;
        font-weight: 600;
      }

      .logout-btn {
        background: #fff;
        color: #7b4ae2;
        border: none;
        padding: 10px 22px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: 0.3s;
      }

      .logout-btn:hover {
        background: #f0e9ff;
        transform: translateY(-2px);
      }

      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 40px;
      }

      h1 {
        font-size: 38px;
        font-weight: 600;
        margin-bottom: 10px;
      }

      p {
        font-size: 18px;
        opacity: 0.9;
        margin-bottom: 40px;
      }

      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        width: 90%;
        max-width: 1100px;
      }

      .card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(8px);
        border-radius: 16px;
        padding: 30px;
        text-align: left;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        cursor: pointer;
      }

      .card:hover {
        transform: translateY(-6px);
        background: rgba(255, 255, 255, 0.25);
      }

      .card h3 {
        font-size: 22px;
        margin-bottom: 10px;
      }

      .card p {
        font-size: 15px;
        opacity: 0.85;
      }

      /* Modal Base */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 10;
      }

      .modal-content {
        background: white;
        color: #333;
        border-radius: 16px;
        padding: 30px 40px;
        width: 90%;
        max-width: 450px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        animation: popUp 0.3s ease;
      }

      @keyframes popUp {
        from {
          transform: scale(0.8);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .modal-content h2 {
        margin-bottom: 20px;
        text-align: center;
        color: #7b4ae2;
      }

      .modal-content input,
      .modal-content textarea,
      .modal-content select {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 15px;
      }

      .modal-content button {
        background: #7b4ae2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: 0.3s;
        margin-top: 10px;
        display: block;
        margin-left: auto;
        margin-right: auto;
      }

      .modal-content button:hover {
        background: #6d3edc;
      }

      /* Profile photo */
      #profilePreview {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: block;
        margin: 10px auto;
        object-fit: cover;
        border: 2px solid #7b4ae2;
      }

      /* Places grid */
      .places-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 15px;
      }

      .place-card {
        background: #f7f4ff;
        color: #333;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: 0.3s;
        font-weight: 500;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      }

      .place-card:hover {
        background: #e6dcff;
        transform: translateY(-3px);
      }
    </style>
  </head>

  <body>
    <header>
      <div class="logo">ARMap</div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </header>

    <main>
      <h1 id="welcomeText">Welcome back ðŸ‘‹</h1>
      <p>Hereâ€™s your personalized dashboard</p>

      <div class="cards">
        <div class="card" onclick="openProfileModal()">
          <h3>Profile</h3>
          <p>View and update your personal information.</p>
        </div>
        <div class="card" onclick="openPlacesModal()">
          <h3>Places</h3>
          <p>Navigate to places you want to visit easily.</p>
        </div>
        <div class="card" onclick="openSettingsModal()">
          <h3>Settings</h3>
          <p>Customize your dashboard preferences and layout.</p>
        </div>
        <div class="card" onclick="openNotificationsModal()">
          <h3>Notifications (0)</h3>
          <p>Stay up to date with alerts and updates.</p>
        </div>
      </div>
    </main>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
      <div class="modal-content">
        <h2>Edit Profile</h2>
        <input
          type="file"
          id="profilePhoto"
          accept="image/*"
          onchange="previewPhoto(event)"
        />
        <img id="profilePreview" src="" alt="Profile Photo" />
        <input type="text" id="profileName" placeholder="Full Name" />
        <input type="email" id="profileEmail" placeholder="Email" />
        <textarea id="profileBio" placeholder="Short Bio" rows="3"></textarea>
        <button onclick="saveProfile()">Save</button>
      </div>
    </div>

    <!-- Places Modal -->
    <div class="modal" id="placesModal">
      <div class="modal-content">
        <h2>Explore Places</h2>
        <input
          type="text"
          id="placeSearch"
          placeholder="Search for a place..."
          onkeyup="filterPlaces()"
        />
        <div class="places-grid">
          <div class="place-card" onclick="openPlaceDetail('A1 Block')">
            A1 Block
          </div>
          <div class="place-card" onclick="openPlaceDetail('B5 Block')">
            B5 Block
          </div>
          <div class="place-card" onclick="openPlaceDetail('C1 Block')">
            C1 Block
          </div>
          <div class="place-card" onclick="openPlaceDetail('D2 Block')">
            D2 Block
          </div>
          <div class="place-card" onclick="openPlaceDetail('D6 Block')">
            D6 Block
          </div>
          <div class="place-card" onclick="openPlaceDetail('KCC Building')">
            KCC Building
          </div>
        </div>
      </div>
    </div>

    <!-- Place Detail Modal -->
    <div class="modal" id="placeDetailModal">
      <div class="modal-content">
        <h2 id="placeTitle"></h2>
        <p
          id="placeDescription"
          style="text-align: center; line-height: 1.5"
        ></p>
        <button onclick="showOnMap()">Show on Map</button>
        <button onclick="closePlaceDetail()">Close</button>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
      <div class="modal-content">
        <h2>Settings</h2>
        <label>Theme:</label>
        <select id="themeSelect">
          <option value="purple">Purple</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>

        <label>Font Size:</label>
        <select id="fontSelect">
          <option value="14px">Small</option>
          <option value="16px">Medium</option>
          <option value="18px">Large</option>
        </select>

        <label>Enable Notifications:</label>
        <input type="checkbox" id="notifToggle" checked />
        <button onclick="saveSettings()">Save Settings</button>
      </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal" id="notificationsModal">
      <div class="modal-content">
        <h2>Notifications</h2>
        <ul id="notifList" style="list-style: none; padding-left: 0"></ul>
      </div>
    </div>

    <script>
      // ---------------- Profile ----------------
      // Save profile to backend
      async function saveProfile() {
        const name = document.getElementById("profileName").value.trim();
        const email = document.getElementById("profileEmail").value.trim();
        const bio = document.getElementById("profileBio").value.trim();
        const photo = document.getElementById("profilePreview").src;

        if (!name || !email) {
          alert("Please fill in all required fields.");
          return;
        }

        const res = await fetch("http://localhost:5000/api/saveProfile", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, bio, photo }),
        });

        const data = await res.json();
        alert(data.message);
        profileModal.style.display = "none";
      }

      // Load profile
      async function loadProfile() {
        const email = localStorage.getItem("userEmail");
        if (!email) return;

        const res = await fetch(
          `http://localhost:5000/api/getProfile/${email}`
        );
        const data = await res.json();

        if (data) {
          document.getElementById("profileName").value = data.name || "";
          document.getElementById("profileEmail").value = data.email || "";
          document.getElementById("profileBio").value = data.bio || "";
          if (data.photo)
            document.getElementById("profilePreview").src = data.photo;
        }
      }

      // Fetch places from backend
      async function loadPlaces() {
        const res = await fetch("http://localhost:5000/api/places");
        const places = await res.json();
        console.log("Loaded places:", places);
      }

      // Load profile
      async function loadProfile() {
        const email = localStorage.getItem("userEmail");
        if (!email) return;

        const res = await fetch(
          `http://localhost:5000/api/getProfile/${email}`
        );
        const data = await res.json();

        if (data) {
          document.getElementById("profileName").value = data.name || "";
          document.getElementById("profileEmail").value = data.email || "";
          document.getElementById("profileBio").value = data.bio || "";
          if (data.photo)
            document.getElementById("profilePreview").src = data.photo;
        }
      }

      // Fetch places from backend
      async function loadPlaces() {
        const res = await fetch("http://localhost:5000/api/places");
        const places = await res.json();
        console.log("Loaded places:", places);
      }

      // ---------------- Places ----------------
      const placeInfo = {
        "A1 Block": "Administrative block where all important people sit.",
        "B5 Block": "Department of Art and Cultural Affairs.",
        "C1 Block": "First year engineering block.",
        "D2 Block": "AIT block, houses the Department of CSE AIML.",
        "D6 Block": "Cafeteria and Library.",
        "KCC Building": "Kalpana Chawla Centre for Space Research.",
      };

      const placesModal = document.getElementById("placesModal");
      const placeDetailModal = document.getElementById("placeDetailModal");

      function openPlacesModal() {
        placesModal.style.display = "flex";
      }

      function filterPlaces() {
        const input = document
          .getElementById("placeSearch")
          .value.toLowerCase();
        const cards = document.querySelectorAll(".place-card");
        cards.forEach((card) => {
          const text = card.innerText.toLowerCase();
          card.style.display = text.includes(input) ? "block" : "none";
        });
      }

      function openPlaceDetail(place) {
        document.getElementById("placeTitle").innerText = place;
        document.getElementById("placeDescription").innerText =
          placeInfo[place];
        localStorage.setItem("lastPlace", place);
        placeDetailModal.style.display = "flex";
      }

      function closePlaceDetail() {
        placeDetailModal.style.display = "none";
      }

      function showOnMap() {
        const place = document.getElementById("placeTitle").innerText;
        alert(`(Future feature) Showing map for ${place}`);
      }

      // ---------------- Settings ----------------
      const settingsModal = document.getElementById("settingsModal");
      const defaultSettings = {
        theme: "purple",
        fontSize: "16px",
        notifications: true,
      };

      function openSettingsModal() {
        const saved =
          JSON.parse(localStorage.getItem("userSettings")) || defaultSettings;
        document.getElementById("themeSelect").value = saved.theme;
        document.getElementById("fontSelect").value = saved.fontSize;
        document.getElementById("notifToggle").checked = saved.notifications;
        settingsModal.style.display = "flex";
      }

      async function saveSettings() {
        const email = storedUser.email;
        const selected = document.getElementById("themeSelect").value;

        const response = await fetch("http://localhost:5000/api/settings", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, theme: selected }),
        });

        const data = await response.json();

        if (data.success) {
          localStorage.setItem("theme", selected);
          applyTheme(selected);
          alert("âœ… Settings saved!");
          settingsModal.style.display = "none";
        } else {
          alert("âŒ Could not save settings!");
        }
      }

      function applySettings(settings) {
        applyTheme(settings.theme);
        document.body.style.fontSize = settings.fontSize;
      }

      function applyTheme(theme) {
        if (theme === "light") {
          document.body.style.background = "#f2f2f2";
          document.body.style.color = "#333";
        } else if (theme === "dark") {
          document.body.style.background = "#121212";
          document.body.style.color = "#fff";
        } else {
          document.body.style.background =
            "linear-gradient(135deg, #7b4ae2, #b26dfc)";
          document.body.style.color = "white";
        }
      }

      applySettings(
        JSON.parse(localStorage.getItem("userSettings")) || defaultSettings
      );

      // ---------------- Notifications ----------------
      const notificationsModal = document.getElementById("notificationsModal");
      let notifications = JSON.parse(localStorage.getItem("notifications")) || [
        { msg: "Welcome to ARMap!", read: false },
        { msg: "Profile module upgraded!", read: false },
      ];

      function openNotificationsModal() {
        const list = document.getElementById("notifList");
        list.innerHTML = "";
        notifications.forEach((n, i) => {
          const li = document.createElement("li");
          li.innerHTML = `${n.read ? "âœ…" : "ðŸ””"} ${n.msg}`;
          if (!n.read) {
            const btn = document.createElement("button");
            btn.textContent = "Mark as Read";
            btn.style.marginLeft = "10px";
            btn.onclick = () => markAsRead(i);
            li.appendChild(btn);
          }
          list.appendChild(li);
        });
        notificationsModal.style.display = "flex";
      }

      function markAsRead(index) {
        notifications[index].read = true;
        localStorage.setItem("notifications", JSON.stringify(notifications));
        openNotificationsModal();
        updateNotificationBadge();
      }

      function updateNotificationBadge() {
        const unread = notifications.filter((n) => !n.read).length;
        document.querySelector(
          ".card:nth-child(4) h3"
        ).innerText = `Notifications (${unread})`;
      }
      updateNotificationBadge();

      // ---------------- General ----------------
      window.onclick = (e) => {
        if (e.target.classList.contains("modal")) {
          e.target.style.display = "none";
        }
      };

      function logout() {
        localStorage.removeItem("user");
        localStorage.removeItem("userLoggedIn");
        window.location.href = "index.html";
      }

      // Welcome user
      const storedUser = JSON.parse(localStorage.getItem("user"));
      if (storedUser && storedUser.name) {
        document.getElementById(
          "welcomeText"
        ).innerText = `Welcome back, ${storedUser.name} ðŸ‘‹`;
      }
    </script>
  </body>
</html>
